@model IEnumerable<PiecebyPiece.Models.mCOURSE>

@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout_Admin.cshtml";
}



<center><span class="header-title">Courses Panel</span></center>



@{
    var currentController = ViewContext.RouteData.Values["controller"]?.ToString();

    var activeClass = "nav-item-active";
}

<style>
    .nav-item-active {
        border-radius: 100px;
        background-color: #5AB2A6;
        transition: all 0.3s ease;
        text-decoration: none;
    }

        .nav-item-active .nav-link {
            color: #fff !important;
            text-decoration: none;
        }
</style>
<div class="box-body" style="padding: 10px; margin-bottom: 20px;">
    <div class="d-flex justify-content-center" style="white-space: nowrap;">
        <ul class="nav nav-pills admin-sub-nav">
            <li class="nav-item @(currentController == "cEnrollment" ? activeClass : "")" style="margin: 0 5px;">
                <a class="nav-link text-dark" asp-area="" asp-controller="cEnrollment" asp-action="Index" style="font-weight:600;">Enrollment</a>
            </li>
            <li class="nav-item @(currentController == "cCourse" ? activeClass : "")" style="margin: 0 5px;">
                <a class="nav-link text-dark" asp-area="" asp-controller="cCourse" asp-action="Index" style="font-weight:600;">Course</a>
            </li>
            <li class="nav-item @(currentController == "cCertificate" ? activeClass : "")" style="margin: 0 5px;">
                <a class="nav-link text-dark" asp-area="" asp-controller="cCertificate" asp-action="Index" style="font-weight:600;">Certificate</a>
            </li>
            <li class="nav-item @(currentController == "cUser" ? activeClass : "")" style="margin: 0 5px;">
                <a class="nav-link text-dark" asp-area="" asp-controller="cUser" asp-action="Index" style="font-weight:600;">User</a>
            </li>
            <li class="nav-item @(currentController == "cAdminPanel" ? activeClass : "")" style="margin: 0 5px;">
                <a class="nav-link text-dark" asp-area="" asp-controller="cAdminPanel" asp-action="Index" style="font-weight:600;">Admin</a>
            </li>
        </ul>
    </div>
</div>


@{
    var selectedSubjects = ViewBag.SelectedSubjects as List<string>;
}

<div class="box-body">

    <form asp-action="Index" method="get" id="filterForm" class="mb-3">
        <!-- Search -->
        <div class="input-group mb-2">
            <input type="text" name="cSearch" class="form-control custom-search-input" value="@Context.Request.Query["cSearch"]" placeholder="Search..." />
            <button class="btn-black" type="submit">
                <i class="bi bi-search"></i>
            </button>
        </div>
        <!-- Filter -->
        <div class="mb-2 d-flex align-items-center flex-wrap gap-2" style="margin-left: 10px;">
            <div class="d-flex align-items-center">
                <i class="bi bi-funnel-fill filter-icon me-2" style="color:#49454F;"></i>
                <span class="fw-semibold" style="color:#49454F;">Subject Filter:</span>
            </div>

            <div class="d-flex flex-wrap gap-1">
                @{
                    var subjects = new List<string> { "MTH", "PROD", "COD", "PHY", "ART" };
                }

                @foreach (var subject in subjects)
                {
                    bool isActive = selectedSubjects.Contains(subject);
                    <input type="checkbox" class="btn-check subject-filter" name="cFilter" value="@subject" id="btn-@subject" autocomplete="off" @(isActive ? "checked" : "") />
                    <label class="btn-filter @(isActive ? "active" : "")" for="btn-@subject">@subject.ToUpper()</label>
                }
            </div>
        </div>

    </form>



    <div>
        <!-- Section Header -->
        <div class="section-header mb-2" style="margin-top:50px;">
            <h5 class="section-title mb-0">All Courses</h5>
            <a asp-controller="cCourse" asp-action="Create" class="btn btn-black" aria-label="button">+ Create Course</a>
        </div>

        <!-- Course Card -->
        <div class="course-container">
            @foreach (var course in Model)
            {
                <a asp-controller="cCourse" asp-action="Details" asp-route-id="@course.courseID" class="card-link" aria-label="button">
                    <div class="card-course border-top">
                        <div class="card-table">
                            <table>
                                <colgroup>
                                    <col style="width:70px">
                                    <col style="width:auto">
                                    <col style="width:120px">
                                </colgroup>
                                <tr>
                                    <td class="card-col1">
                                        @if (!string.IsNullOrEmpty(course.coursePhotoPath))
                                        {
                                            <img src="@course.coursePhotoPath" alt="@course.courseName" />
                                        }
                                    </td>
                                    <td class="card-col2">
                                        <div class="card-id">#@course.courseSubject-@course.courseID</div>
                                        <div class="card-title">@course.courseName</div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <!-- Action ปุ่ม -->
                        <div class="card-action" onclick="event.stopPropagation()">
                            <a asp-controller="cLesson" asp-action="Create" asp-route-id="@course.courseID" class="btn btn-black" aria-label="button">+ Add Lesson</a>
                            <a asp-controller="cCourse" asp-action="Edit" asp-route-id="@course.courseID" class="btn btn-yellow-icon" aria-label="button"><i class="bi bi-pencil"></i></a>
                            <a class="btn btn-pink-icon btn-delete-course-modal"
                               data-delete-url="@Url.Action("Delete", "cCourse", new { id = course.courseID })"
                               data-course-id="@course.courseID"
                               data-course-name="@course.courseName"
                               href="#">
                                <i class="bi bi-trash"></i>
                            </a>
                        </div>
                    </div>
                </a>
            }
        </div>
    </div>
</div>


<div class="modal fade" id="deleteCourseConfirmModal" tabindex="-1" aria-labelledby="deleteCourseConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteCourseConfirmModalLabel"><i class="bi bi-exclamation-triangle-fill me-2"></i> Confirm Course Deletion</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close" aria-label="button"></button>
            </div>

            <div class="modal-body text-start">
                <p class="mb-2"><strong>Are you sure you want to delete this course?</strong></p>
                <p class="mb-1">All associated data will also be removed:</p>
                <ul class="list-unstyled ms-3">
                    <li><i class="bi bi-x-circle-fill text-danger me-2"></i> Lessons</li>
                    <li><i class="bi bi-x-circle-fill text-danger me-2"></i> Tests</li>
                    <li><i class="bi bi-x-circle-fill text-danger me-2"></i> Related Data (e.g., Certificate links)</li>
                </ul>
                <p class="mt-3 mb-3"><strong>This action cannot be undone.</strong></p>
                <p class="text-muted small">
                    ID: <strong id="courseIdToDelete" class="text-danger"></strong> | Course: <strong id="courseNameToDelete" class="text-danger"></strong>
                </p>
            </div>

            <div class="modal-footer">
                <a id="confirmCourseDeleteButton" class="btn btn-danger" aria-label="button">
                    Delete Course
                </a>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" aria-label="button">Cancel</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            var deleteCourseModal = new bootstrap.Modal(document.getElementById('deleteCourseConfirmModal'));

            $('.btn-delete-course-modal').on('click', function (e) {
                e.preventDefault();

                var deleteUrl = $(this).data('delete-url');
                var courseId = $(this).data('course-id');
                var courseName = $(this).data('course-name');

                $('#courseIdToDelete').text(courseId);
                $('#courseNameToDelete').text(courseName);

                $('#confirmCourseDeleteButton').attr('href', deleteUrl);

                deleteCourseModal.show();
            });
        });
    </script>
}