@model PiecebyPiece.Models.mUSER

@{
    ViewData["Title"] = "Details";
    Layout = "~/Views/Shared/_Layout_Admin.cshtml";
}



<center><span class="header-title">User Details</span></center>

<div class="box-body">
    <!-- Action Bar -->
    <div class="action-bar">
        <div class="left-actions">
            <a asp-action="Index" class="btn btn-mint-icon"><i class="bi bi-arrow-left" aria-label="button"></i></a>
            <a asp-action="Edit" asp-route-id="@Model?.userID" class="btn btn-yellow-icon" aria-label="button"><i class="bi bi-pencil"></i></a>
        </div>

        <div class="right-actions">
            <a class="btn btn-pink-icon btn-delete-modal" aria-label="button"
               data-delete-url="@Url.Action("Delete", new { id = Model?.userID })"
               data-user-id="@Model?.userID"
               data-user-name="@Model?.userName"
               data-user-surname="@Model?.userSurname"
               href="#">
                <i class="bi bi-trash"></i>
            </a>
        </div>
    </div>



    <!-- User Infomation -->
    <center>
        @if (Model.userPhotoPath != null)
        {
            <div class="mt-3">
                <img src="@Model.userPhotoPath" alt="User Profile" style="max-width: 200px; border-radius: 10px;margin-top:10px;" />
            </div>
        }
    </center>
    <table class="info-table" style="margin-top:20px;">
        <tr>
            <th>ID</th>
            <td>
                @Html.DisplayFor(model => model.userID)
            </td>
        </tr>
        <tr>
            <th>Fullname</th>
            <td>
                @Html.DisplayFor(model => model.userName) @Html.DisplayFor(model => model.userSurname)
            </td>
        </tr>
        <tr>
            <th>Email</th>
            <td>
                @Html.DisplayFor(model => model.userEmail)
            </td>
        </tr>
        <tr>
            <th>Password</th>
            <td>
                @Html.DisplayFor(model => model.userPassword)
            </td>
        </tr>
    </table>
</div>


<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteConfirmModalLabel"><i class="bi bi-exclamation-triangle-fill me-2"></i>Confirm User Deletion</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>


            <div class="modal-body text-start">
                <p class="mb-2"><strong>Are you sure you want to delete this user?</strong></p>
                <p class="mb-1">All associated data will also be removed:</p>
                <ul class="list-unstyled ms-3">
                    <li><i class="bi bi-x-circle-fill text-danger me-2"></i> Enrollment</li>
                    <li><i class="bi bi-x-circle-fill text-danger me-2"></i> Certificate</li>
                    <li><i class="bi bi-x-circle-fill text-danger me-2"></i> Related Data</li>
                </ul>
                <p class="mt-3 mb-3"><strong>This action cannot be undone.</strong></p>

                <p class="text-muted small">
                    ID: <strong id="userIdToDelete" class="text-danger"></strong> | User: <strong id="userNameToDelete" class="text-danger"></strong> <strong id="userSurnameToDelete" class="text-danger"></strong>
                </p>

                <form id="deleteForm" method="post" style="display: none;">
                    @Html.AntiForgeryToken()
                    <input type="hidden" id="deleteUserIdInput" name="id" />
                </form>

            </div>



            <div class="modal-footer">
                <a id="confirmDeleteButton" class="btn btn-danger" aria-label="button">
                    Delete User
                </a>

                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" aria-label="button">Cancel</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {

            $('.btn-delete-modal').on('click', function (e) {
                e.preventDefault();

                var userId = $(this).data('user-id');
                var userName = $(this).data('user-name');
                var userSurname = $(this).data('user-surname');
                var deleteUrl = $(this).data('delete-url');

                $('#userIdToDelete').text(userId);
                $('#userNameToDelete').text(userName);
                $('#userSurnameToDelete').text(userSurname);

                $('#deleteUserIdInput').val(userId);
                $('#deleteForm').attr('action', deleteUrl);

                var deleteModal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
                deleteModal.show();
            });

            $('#confirmDeleteButton').on('click', function () {
                $('#deleteForm').submit();
            });
        });
    </script>
}
